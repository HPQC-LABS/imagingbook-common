package imagingbook.lib.math;

import java.util.List;

import imagingbook.lib.settings.PrintPrecision;

public abstract class ProcrustesExample {
	
	public abstract void run();
	
	protected double roundToDigits(double x, int ndigits) {
		int d = (int) Math.pow(10, ndigits);
		return Math.rint(x * d) / d;
	}
	
	
	protected void showHeadline(String title) {
		System.out.println("\n**************** " + title + " ****************");
	}
	
	protected void print(List<double[]> lX) {
		for (double[] x : lX) {
			System.out.println("   " + Matrix.toString(x));
		}
	}
	
	
	public static void main(String[] args) {
		PrintPrecision.set(10);
		new ProcrustesExample1().run();
		new ProcrustesExample2().run();
	}


}


/*


**************** ProcrustesExample1 (WB) ****************
original scale = 3.5
original R = 
{{0.8253356149, -0.5646424734}, 
{0.5646424734, 0.8253356149}}
original t = {4.0000000000, -3.0000000000}
lA = 
   {2.0000000000, 5.0000000000}
   {7.0000000000, 3.0000000000}
   {0.0000000000, 9.0000000000}
   {5.0000000000, 4.0000000000}
lB = 
   {-0.1000000000, 15.4000000000}
   {18.3000000000, 19.5000000000}
   {-13.8000000000, 23.0000000000}
   {10.5000000000, 18.4000000000}
meanA = 
{3.5000000000, 5.2500000000}
meanB = 
{3.7250000000, 19.0750000000}
A = 
{{-1.5000000000, 3.5000000000, -3.5000000000, 1.5000000000}, 
{-0.2500000000, -2.2500000000, 3.7500000000, -1.2500000000}}
B = 
{{-3.8250000000, 14.5750000000, -17.5250000000, 6.7750000000}, 
{-3.6750000000, 0.4250000000, 3.9250000000, -0.6750000000}}
------ SVD ---------------
U = {{0.9954697574, -0.0950787155}, 
{-0.0950787155, -0.9954697574}}
S = {{167.1571443495, 0.0000000000}, 
{0.0000000000, 6.9957374813}}
V = {{0.7681745039, -0.6402405264}, 
{-0.6402405264, -0.7681745039}}
--------------------------
rank of BAt = 2, full = true
det(BAt) = 1169.3875
det(U) = -0.9999999999999997
det(V) = -0.9999999999999999
calculateEuclideanError:
  b0 = {2.0000000000, 5.0000000000}
  a0 = {-0.1160804020, 15.3894472362}
    d1 = 0.019233828350761036
    d2 = 3.69940153026539E-4
  b1 = {7.0000000000, 3.0000000000}
  a1 = {18.2844221106, 19.4864321608}
    d1 = 0.02065809526743817
    d2 = 4.2675690007855133E-4
  b2 = {0.0000000000, 9.0000000000}
  a2 = {-13.7974874372, 22.9984924623}
    d1 = 0.0029301265803308605
    d2 = 8.585641776761424E-6
  b3 = {5.0000000000, 4.0000000000}
  a3 = {10.5291457286, 18.4256281407}
    d1 = 0.03881076002944283
    d2 = 0.0015062750940629973
c = 3.500560438811632
Q = 
{{0.8255677339, -0.5643030363}, 
{0.5643030363, 0.8255677339}}
t = 
{3.9809045226, -3.0110552764}
err1 = 0.0023115577890848726
err2 = 0.002311557788944849
map = 
{{2.8899497487, -1.9753768844, 3.9809045226}, 
{1.9753768844, 2.8899497487, -3.0110552764}, 
{0.0000000000, 0.0000000000, 1.0000000000}}

**************** ProcrustesExample2 ( Umeyama-Test) ****************
lA = 
   {0.0000000000, 0.0000000000}
   {1.0000000000, 0.0000000000}
   {0.0000000000, 2.0000000000}
lB = 
   {0.0000000000, 0.0000000000}
   {-1.0000000000, 0.0000000000}
   {0.0000000000, 2.0000000000}
     --- Case 1: rotation NOT enforced (reflection allowed) -------------
meanA = 
{0.3333333333, 0.6666666667}
meanB = 
{-0.3333333333, 0.6666666667}
A = 
{{-0.3333333333, 0.6666666667, -0.3333333333}, 
{-0.6666666667, -0.6666666667, 1.3333333333}}
B = 
{{0.3333333333, -0.6666666667, 0.3333333333}, 
{-0.6666666667, -0.6666666667, 1.3333333333}}
------ SVD ---------------
U = {{-0.2897841487, -0.9570920265}, 
{-0.9570920265, 0.2897841487}}
S = {{2.8685170918, 0.0000000000}, 
{0.0000000000, 0.4648162415}}
V = {{0.2897841487, 0.9570920265}, 
{-0.9570920265, 0.2897841487}}
--------------------------
rank of BAt = 2, full = true
det(BAt) = -1.3333333333333335
det(U) = -1.0
det(V) = 0.9999999999999999
calculateEuclideanError:
  b0 = {0.0000000000, 0.0000000000}
  a0 = {0.0000000000, 0.0000000000}
    d1 = 1.1102230246251565E-16
    d2 = 1.232595164407831E-32
  b1 = {1.0000000000, 0.0000000000}
  a1 = {-1.0000000000, 0.0000000000}
    d1 = 1.1102230246251565E-16
    d2 = 1.232595164407831E-32
  b2 = {0.0000000000, 2.0000000000}
  a2 = {-0.0000000000, 2.0000000000}
    d1 = 2.2204460492503128E-16
    d2 = 4.9303806576313227E-32
c = 0.9999999999999999
Q = 
{{-1.0000000000, -0.0000000000}, 
{-0.0000000000, 1.0000000000}}
t = 
{0.0000000000, 0.0000000000}
err1 = 1.3322676295501878E-15
err2 = 7.395570986446985E-32
map = 
{{-1.0000000000, -0.0000000000, 0.0000000000}, 
{-0.0000000000, 1.0000000000, 0.0000000000}, 
{0.0000000000, 0.0000000000, 1.0000000000}}
     --- Case 2: rotation enforced (NO reflection allowed) -------------
meanA = 
{0.3333333333, 0.6666666667}
meanB = 
{-0.3333333333, 0.6666666667}
A = 
{{-0.3333333333, 0.6666666667, -0.3333333333}, 
{-0.6666666667, -0.6666666667, 1.3333333333}}
B = 
{{0.3333333333, -0.6666666667, 0.3333333333}, 
{-0.6666666667, -0.6666666667, 1.3333333333}}
------ SVD ---------------
U = {{-0.2897841487, -0.9570920265}, 
{-0.9570920265, 0.2897841487}}
S = {{2.8685170918, 0.0000000000}, 
{0.0000000000, 0.4648162415}}
V = {{0.2897841487, 0.9570920265}, 
{-0.9570920265, 0.2897841487}}
--------------------------
rank of BAt = 2, full = true
det(BAt) = -1.3333333333333335
det(U) = -1.0
det(V) = 0.9999999999999999
calculateEuclideanError:
  b0 = {0.0000000000, 0.0000000000}
  a0 = {-0.8000000000, 0.4000000000}
    d1 = 0.8944271909999157
    d2 = 0.7999999999999997
  b1 = {1.0000000000, 0.0000000000}
  a1 = {-0.2000000000, 0.0000000000}
    d1 = 0.7999999999999999
    d2 = 0.6399999999999999
  b2 = {0.0000000000, 2.0000000000}
  a2 = {-0.0000000000, 1.6000000000}
    d1 = 0.40000000000000036
    d2 = 0.16000000000000028
c = 0.7211102550927977
Q = 
{{0.8320502943, 0.5547001962}, 
{-0.5547001962, 0.8320502943}}
t = 
{-0.8000000000, 0.4000000000}
err1 = 1.6000000000000005
err2 = 1.5999999999999999
map = 
{{0.6000000000, 0.4000000000, -0.8000000000}, 
{-0.4000000000, 0.6000000000, 0.4000000000}, 
{0.0000000000, 0.0000000000, 1.0000000000}}
*/
